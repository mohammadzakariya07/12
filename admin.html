<!DOCTYPE html>
<html>
<head>
<title>Admin Panel</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body { font-family: Arial; background:#eef2f5; padding:20px; }
.box { background:#fff; padding:20px; max-width:500px; margin:auto; }
select, input, textarea, button { width:100%; padding:8px; margin-top:10px; }
#popup { display:none; position:fixed; inset:0; background:rgba(0,0,0,.5); }
.popup-box { background:#fff; padding:20px; margin:60px auto; width:450px; }
canvas { margin-top:20px; }
</style>
</head>

<body>

<div class="box" id="loginBox">
<h3>Admin Login</h3>
<input id="u" placeholder="Username">
<input id="p" type="password" placeholder="Password">
<button onclick="login()">Login</button>
<p id="err" style="color:red"></p>
</div>

<div class="box" id="panel" style="display:none">
<h3>Applications</h3>
<select id="list" onchange="openPopup()"></select>
</div>

<div id="popup">
<div class="popup-box">
<button onclick="done()">Done</button>
<button onclick="notDone()">Not Done</button>
<div id="form"></div>
<canvas id="chart"></canvas>
<button onclick="submit()">Submit</button>
</div>
</div>

<script>
const API =
"https://script.google.com/macros/s/AKfycbxRffghkixlECYJ6JGGAUFULLCvuIwtJAUKphFgvcczYBx_1bX-5ov9SO_JbU6r6_TL/exec";

let row="", status="";

function login(){
  if(u.value==="admin" && p.value==="admin123"){
    loginBox.style.display="none";
    panel.style.display="block";
    fetch(API).then(r=>r.json()).then(d=>{
      list.innerHTML='<option>Select</option>';
      d.forEach(i=>{
        list.innerHTML+=`<option value="${i.row}">${i.row} | ${i.updateType} | ${i.status}</option>`;
      });
    });
  } else err.innerText="Invalid credentials";
}

function openPopup(){
  row=list.value;
  popup.style.display="block";
}

function done(){
  status="Done";
  form.innerHTML='Phone:<input id="phone">';
  fetch(API+'?action=doneTypes').then(r=>r.json()).then(drawChart);
}

function notDone(){
  status="Not Done";
  form.innerHTML='Reason:<textarea id="remarks"></textarea>Phone:<input id="phone">';
  fetch(API+'?action=notDoneReasons').then(r=>r.json()).then(drawChart);
}

function drawChart(data){
  new Chart(chart,{
    type:"bar",
    data:{labels:Object.keys(data),datasets:[{data:Object.values(data),backgroundColor:"#3b82f6"}]}
  });
}

function submit(){
  fetch(API,{
    method:"POST",
    headers:{"Content-Type":"application/x-www-form-urlencoded"},
    body:`action=update&row=${row}&status=${status}&remarks=${remarks?.value||""}&phone=${phone.value}`
  }).then(()=>location.reload());
}
</script>

</body>
</html>
